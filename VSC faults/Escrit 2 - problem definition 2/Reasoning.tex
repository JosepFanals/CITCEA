\documentclass[10pt]{article}

\usepackage[left=30mm, right=30mm]{geometry}
%\usepackage[scale=4]{draftwatermark}

\usepackage[backend=biber, sorting=none]{biblatex} % per la bibliografia
\setlength\bibitemsep{\baselineskip} % per tenir m√©s espai entre bibliografia
\addbibresource{bib.bib} % carregar el fitxer de bibliografia
\usepackage{bm}
\usepackage{amsmath}
\usepackage[activate={true, noncompatibility}]{microtype}
\usepackage{tikz}
\usepackage{circuitikz}
% \usepackage[american voltages, american currents,siunitx]{circuitikz}
\usepackage{amssymb}
\usepackage{diagbox}
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}
\usetikzlibrary{arrows.meta}
% \usepackage[american voltages, american currents,siunitx]{circuitikz}

\begin{document}

\begin{center}
    \Large
    \textbf{Positive and negative sequence currents to improve voltages during unbalanced faults}
         
    \vspace{0.4cm}
    \textbf{Josep Fanals}
       
       
    \vspace{0.4cm}
    \textbf{02/2021}
\end{center}

\section{Introduction}
Grid faults constitute a group of unfortunate events that cause severe perturbations in the grid. The voltages can take values below the established minimum, or on the contrary, exceed the maximum in non-faulted phases. The currents are also susceptible to vary considerably. Traditional power systems based on synchronous generators could encounter currents surpassing the nominal values, and therefore, the fault could be clearly detected. However, the increasing integration of renewables \cite{anees2012grid} supposes a change of paradigm, in which currents can be controlled but are limited so as not to damage the Isolated-Gate Bipolar Transistors (IGBT) found in the Voltage Source Converter (VSC) \cite{abdou2013improving}. 

Transmission System Operators (TSO) are responsible for imposing requirements related to the operation under voltage sags to generators and converters \cite{tsili2009review, iov2007mapping}. Such requirements are gathered in the respective grid codes. There seems to be no clear consensus on how to restore the voltage. In this sense, even if for instance the Low Voltage Ride Through (LVRT) profiles present similarities \cite{conroy2007low}, analysis aimed at determining analytically the optimal injection of positive and negative sequence currents are not numerous. As far as the author is aware, only Camacho et al. offer an optimal solution regarding the injection of active and reactive powers \cite{camacho2017positive}. 

Consequently, this work focuses on finding the most convenient positive and negative sequence currents (and not powers) to raise the voltage at the point of common coupling. First, a simple model is discussed, and then, the results are shown together with the corresponding discussion. The challenge to solve the optimization problem in a closed-form is specially described.

\section{Problem definition}
The system we are considering is formed by an ideal grid (only positive sequence voltage is present) coupled to a VSC. The model is depicted in Figure \ref{fig:sys_p}. The VSC will be controlled in a way that leads to an improvement in the voltage at the PCC.

\begin{figure}[!htb] \centering
\begin{circuitikz}[european]
\thicklines

\draw (0,0) to [sV, v_=$\underline{V}_{th}$] (0,2);
\draw (-3,2) to [R, l=$\underline{Z}_{th}$] (0,2);
\draw (-0.25,0) to [short] (0.25,0);
\node at (-6,1.3) {PCC};
\node at (-6,2.7) {$\underline{V}_c$};
\draw (-3,2) to [short] (-3.2,1);
\draw (-3.2,1) to [short] (-2.8,1);
\draw[-{Latex[length=3mm]}] (-2.8,1) to [short] (-3,0);
\draw (-6,2) to [R, l=$\underline{Z}_a$] (-3,2);
\draw[line width=0.65mm] (-6,2.5) to [short] (-6,1.5);
\draw[line width=0.65mm] (-3,2.5) to [short] (-3,1.5);
\draw (-9,2) to [R, l=$\underline{Z}_c$] (-6,2);
\draw (-10.0,2) to [sdcac] (-9.0,2);


\end{circuitikz}
\caption{Single-phase representation of the simple system under a fault}
\label{fig:sys_p}
\end{figure}
The point of common coupling (PCC) is where the VSC together with its filter are connected. There are two restrictions to take into account in a VSC, one related to the maximum current and another to the voltage. The current limitation is likely the most relevant when operating under faults. Since the current is limited and the filter used to connect the VSC to the PCC takes rather low values, we can expect the voltage drop to not be substantial. Because of that, and taking into consideration the voltage sag at the grid side, the voltage limit is hardly ever surpassed. Thus, in the analysis that follows, we only impose the current restriction. As future work, we could also add the voltage limitations as a constraint, although probably the conclusions will not vary from the ones extracted here.

Note that Figure \ref{fig:sys_p} is general, in the sense that it does not specify the type of fault. Besides, there will be a fault impedance, denoted by $\underline{Z}_f$. We believe every unbalanced fault deserves to be studied separately. We are going to employ the symmetrical components, which are meant to simplify the analysis. In each fault, the voltage $\underline{V}_c$ will be decomposed in positive and negative sequence voltage and expressed as a function of the voltage at the grid together with the injected positive and negative sequence currents. It makes sense to model the VSC and its filter as a current source for this purpose. 

\subsection{Line to ground fault}
A line to ground (LG) fault involves the series connection of the equivalent circuit of the three symmetrical components. Transforming the circuit in Figure \ref{fig:sys_p} to an equivalent circuit in the positive, the negative and the homopolar component results in the representation shown in Figure \ref{fig:sys_LG}.



\begin{figure}[!htb] \centering
\begin{circuitikz}[european]
\thicklines

\draw (0,6) to [sV, v_=$\underline{V}_{th}^+$] (0,8);
\draw (-3,8) to [R, l=$\underline{Z}_{th}$] (0,8);
\draw (-6,6) to [short] (0.0,6);
\draw (-6,8) to [R, l=$\underline{Z}_a$] (-3,8);
\draw (-6,6.5) to [american controlled current source, l_=$I^+$] (-6,7.5);
\draw (-6,6) to [short] (-6,6.5);
\draw (-6,7.5) to [short] (-6,8);
\draw (-6.3,8) to [open,v=$\underline{V}^+_c$] (-6.3,6);

\draw (0,3) to [short] (0,3.5);
\draw (0,3.5) to [short, *-*] (0,4.5);
\draw (0,4.5) to [short] (0,5);
\draw (-3,5) to [R, l=$\underline{Z}_{th}$] (0,5);
\draw (-6,3) to [short] (0.0,3);
\draw (-6,5) to [R, l=$\underline{Z}_a$] (-3,5);
\draw (-6,3.5) to [american controlled current source, l_=$I^-$] (-6,4.5);
\draw (-6,3) to [short] (-6,3.5);
\draw (-6,4.5) to [short] (-6,5);
\draw (-6.3,5) to [open,v=$\underline{V}^-_c$] (-6.3,3);

\draw (0,0) to [short] (0,0.5);
\draw (0,0.5) to [short, *-*] (0,1.5);
\draw (0,1.5) to [short] (0,2);
\draw (-3,2) to [R, l=$\underline{Z}_{th}$] (0,2);
\draw (-6,0) to [short] (0.0,0);
\draw (-6,2) to [R, l=$\underline{Z}_a$] (-3,2);
\draw (-6,0) to [short, -*] (-6,0.5);
\draw (-6,1.5) to [short, *-] (-6,2);
\draw (-6.3,2) to [open,v=$\underline{V}^0_c$] (-6.3,0);

\draw (-3,2) to [short, *-*] (-3,3);
\draw (-3,5) to [short, *-*] (-3,6);
\draw (-3,8) to [short, *-] (-3, 9);
\draw (-3,0) to [short, *-] (-3, -0.5);

\draw (-3,9) to [short] (2,9);
\draw (-3,-0.5) to [short] (2,-0.5);
\draw (2,9) to [R, l=$3\underline{Z}_f$] (2, -0.5);

\end{circuitikz}
\caption{Equivalent circuit for the LG fault analysis}
\label{fig:sys_LG}
\end{figure}
The equations that define the positive and negative sequence voltages at the PCC for the line to ground fault are
\begin{equation}
    \begin{cases}
        \underline{V}^+_c=\dfrac{1}{3Z_f + 3Z_b}\left[\underline{V}^+_{th} (3\underline{Z}_f + 2\underline{Z}_b) + \underline{I}^+(3\underline{Z}_a\underline{Z}_f + 3\underline{Z}_a\underline{Z}_b + 3\underline{Z}_b\underline{Z}_f + 2\underline{Z}^2_b) + \underline{I}^-(-\underline{Z}^2_b)   \right] \vspace{0.4cm} \\ 
        \underline{V}^-_c=\dfrac{1}{3Z_f + 3Z_b}\left[\underline{V}^+_{th} (-\underline{Z}_{th}) + \underline{I}^+(-\underline{Z}^2_b) + \underline{I}^-(3\underline{Z}_a\underline{Z}_f + 3\underline{Z_a}\underline{Z}_b + 3\underline{Z}_f\underline{Z}_b + 2\underline{Z}^2_b      )   \right]
    \end{cases}
\end{equation}


\subsection{Line to line fault}
A line to line (LL) fault involves the parallel connection of the equivalent circuit of the positive and negative sequences. In this case, the homopolar sequence can be ignored, as no current flows through it. This time we are only going to work with the positive and the negative components. Figure \ref{fig:sys_LL} presents the equivalent circuit.



\begin{figure}[!htb] \centering
\begin{circuitikz}[european]
\thicklines

\draw (0,6) to [sV, v_=$\underline{V}_{th}^+$] (0,8);
\draw (-2.5,8) to [R, l=$\underline{Z}_{th}$] (0,8);
\draw (-5,6) to [short] (0.0,6);
\draw (-5,8) to [R, l=$\underline{Z}_a$] (-2.5,8);
\draw (-5,6.5) to [american controlled current source, l_=$I^+$] (-5,7.5);
\draw (-5,6) to [short] (-5,6.5);
\draw (-5,7.5) to [short] (-5,8);
\draw (-5.3,8) to [open,v=$\underline{V}^+_c$] (-5.3,6);

\draw (8,6) to [short] (8,6.5);
\draw (8,6.5) to [short, *-*] (8,7.5);
\draw (8,7.5) to [short] (8,8);
\draw (5.5,8) to [R, l=$\underline{Z}_{th}$] (8,8);
\draw (3,6) to [short] (8.0,6);
\draw (3,8) to [R, l=$\underline{Z}_a$] (5.5,8);
\draw (3,6.5) to [american controlled current source, l_=$I^-$] (3,7.5);
\draw (3,6) to [short] (3,6.5);
\draw (3,7.5) to [short] (3,8);
\draw (2.7,8) to [open,v=$\underline{V}^-_c$] (2.7,6);

\draw (-2.5, 8) to [short, *-] (-2.5, 9);
\draw (-2.5, 9) to [R, l=$\underline{Z}_{f}$] (5.5,9);
\draw (5.5,9) to [short, -*] (5.5, 8);

\draw (-2.5, 6) to [short, *-] (-2.5, 5.5);
\draw (-2.5, 5.5) to [short] (5.5, 5.5);
\draw (5.5, 5.5) to [short, -*] (5.5, 6);

\end{circuitikz}
\caption{Equivalent circuit for the LL fault analysis}
\label{fig:sys_LL}
\end{figure}
The equations that define the positive and negative sequence voltages at the PCC for the line to line fault are
\begin{equation}
    \begin{cases}
        \underline{V}^+_c=\dfrac{1}{3Z_f + 3Z_b}\left[\underline{V}^+_{th} (3\underline{Z}_f + 2\underline{Z}_b) + \underline{I}^+(3\underline{Z}_a\underline{Z}_f + 3\underline{Z}_a\underline{Z}_b + 3\underline{Z}_b\underline{Z}_f + 2\underline{Z}^2_b) + \underline{I}^-(-\underline{Z}^2_b)   \right] \vspace{0.4cm} \\ 
        \underline{V}^-_c=\dfrac{1}{3Z_f + 3Z_b}\left[\underline{V}^+_{th} (-\underline{Z}_{th}) + \underline{I}^+(-\underline{Z}^2_b) + \underline{I}^-(3\underline{Z}_a\underline{Z}_f + 3\underline{Z_a}\underline{Z}_b + 3\underline{Z}_f\underline{Z}_b + 2\underline{Z}^2_b      )   \right]
    \end{cases}
\end{equation}


\subsection{Double line to ground fault}
A double line to ground (LLG) fault involves the parallel connection of the equivalent circuit of the three sequences. This time, in contrast to the line to line fault, the homopolar sequence can not be ignored. Furthermore, the fault impedance connects it to the negative sequence circuit. Figure \ref{fig:sys_LLG} presents the complete equivalent circuit. Again, an homopolar voltage will be present, but we have no way to control it since the converter is incapable of injecting homopolar currents in a three-wire system like this one.



\begin{figure}[!htb] \centering
\begin{circuitikz}[european]
\thicklines

\draw (0,8) to [sV, v_=$\underline{V}_{th}^+$] (0,10);
\draw (-3,10) to [R, l=$\underline{Z}_{th}$] (0,10);
\draw (-6,8) to [short] (0.0,8);
\draw (-6,10) to [R, l=$\underline{Z}_a$] (-3,10);
\draw (-6,8.5) to [american controlled current source, l_=$I^+$] (-6,9.5);
\draw (-6,8) to [short] (-6,8.5);
\draw (-6,9.5) to [short] (-6,10);
\draw (-6.3,10) to [open,v=$\underline{V}^+_c$] (-6.3,8);

\draw (0,4) to [short] (0,4.5);
\draw (0,4.5) to [short, *-*] (0,5.5);
\draw (0,5.5) to [short] (0,6);
\draw (-3,6) to [R, l=$\underline{Z}_{th}$] (0,6);
\draw (-6,4) to [short] (0.0,4);
\draw (-6,6) to [R, l=$\underline{Z}_a$] (-3,6);
\draw (-6,4.5) to [american controlled current source, l_=$I^-$] (-6,5.5);
\draw (-6,4) to [short] (-6,4.5);
\draw (-6,5.5) to [short] (-6,6);
\draw (-6.3,6) to [open,v=$\underline{V}^-_c$] (-6.3,4);

\draw (0,0) to [short] (0,0.5);
\draw (0,0.5) to [short, *-*] (0,1.5);
\draw (0,1.5) to [short] (0,2);
\draw (-3,2) to [R, l=$\underline{Z}_{th}$] (0,2);
\draw (-6,0) to [short] (0.0,0);
\draw (-6,2) to [R, l=$\underline{Z}_a$] (-3,2);
\draw (-6,0) to [short, -*] (-6,0.5);
\draw (-6,1.5) to [short, *-] (-6,2);
\draw (-6.3,2) to [open,v=$\underline{V}^0_c$] (-6.3,0);

\draw (-3,0) to [short, *-] (-3,-0.5);
\draw (-3,4) to [short, *-] (-3,3.5);
\draw (-3,8) to [short, *-] (-3,7.5);

\draw (-3,2) to [short, *-] (-3,3);
\draw (-3,6) to [short, *-] (-3,7);
\draw (-3,10) to [short, *-] (-3,11);

\draw (-3,3) to [short] (2,3);
\draw (-3,7) to [short] (2,7);
\draw (-3,11) to [short] (2,11);

\draw (-3,-0.5) to [short] (-8,-0.5);
\draw (-3,3.5) to [short] (-8,3.5);
\draw (-3,7.5) to [short] (-8,7.5);

\draw (-8,-0.5) to [short, -*] (-8, 3.5);
\draw (-8, 3.5) to [short] (-8, 7.5);

\draw (2,3) to [R, l_=$3\underline{Z}_f$, -*] (2,7);
\draw (2,11) to [short] (2,7);




\end{circuitikz}
\caption{Equivalent circuit for the LLG fault analysis}
\label{fig:sys_LLG}
\end{figure}
The equations that define the positive and negative sequence voltages at the PCC for the double line to ground fault are
\begin{equation}
    \begin{cases}
        \underline{V}^+_c=\dfrac{1}{3Z_f + 3Z_b}\left[\underline{V}^+_{th} (3\underline{Z}_f + 2\underline{Z}_b) + \underline{I}^+(3\underline{Z}_a\underline{Z}_f + 3\underline{Z}_a\underline{Z}_b + 3\underline{Z}_b\underline{Z}_f + 2\underline{Z}^2_b) + \underline{I}^-(-\underline{Z}^2_b)   \right] \vspace{0.2cm} \\ 
        \underline{V}^-_c=\dfrac{1}{3Z_f + 3Z_b}\left[\underline{V}^+_{th} (-\underline{Z}_{th}) + \underline{I}^+(-\underline{Z}^2_b) + \underline{I}^-(3\underline{Z}_a\underline{Z}_f + 3\underline{Z_a}\underline{Z}_b + 3\underline{Z}_f\underline{Z}_b + 2\underline{Z}^2_b      )   \right]
    \end{cases}
\end{equation}






\section{Results and discussion}



\section{Conclusions}






\newpage
\printbibliography


\end{document}
