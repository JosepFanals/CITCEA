%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% document class
%\documentclass{beamer}
% \documentclass[aspectratio=169]{beamer}
\documentclass[handout, aspectratio=169, 9pt]{beamer}
\usepackage[utf8x]{inputenc}
\usepackage{textcomp}
\usepackage{eurosym}

%% packages
\input{settings/packages}
 
%% page settings
\input{settings/page}

%% new commands
\input{settings/macros}

% Animations
\usepackage{color}
\usepackage{tikz}
\usepackage{hyperref}
\hypersetup{pdfpagemode=FullScreen}
\usepackage{ifthen}
\usepackage{animate}
%
\newcounter{angle}
\setcounter{angle}{0}
%
 
% CÃ lculs
\usetikzlibrary{calc}
\usepackage{amsmath}
\usepackage{pgfplots} % Animacions

\usepackage[font=tiny]{caption}
\setbeamertemplate{caption}[numbered]
\captionsetup[figure]{labelfont={},name={},labelsep=period} %\renewcommand{\figurename}{Figura} % ho tinc amb caption
\renewcommand{\thefigure}{Figure \arabic{figure}}

\usepackage[font=tiny]{caption}
\setbeamertemplate{caption}[numbered]
\captionsetup[table]{labelfont={},name={},labelsep=period} %\renewcommand{\figurename}{Figura} % ho tinc amb caption
\renewcommand{\thetable}{Table \arabic{table}}
\renewcommand{\arraystretch}{0.5}

\usepackage{amsmath} % \numberwithin{equation} doesn't exist without this package.
\numberwithin{equation}{section} % This line resets equation numbering when starting a new section.
\renewcommand{\theequation}{Eq. \arabic{equation}} % This line ads "Eq." in front of your equation numbering.

\usepackage{tikz}
\usetikzlibrary{shapes,arrows}
\usetikzlibrary{positioning}
\usepackage{tikz-3dplot}
\pgfmathsetmacro{\radius}{1}
\pgfmathsetmacro{\thetavec}{0}
\pgfmathsetmacro{\phivec}{0}
\usepackage{tkz-graph} % Petri diagrams
\usetikzlibrary{intersections}
\usepackage{tkz-euclide}
\usetikzlibrary{positioning,shapes,arrows,arrows.meta}

\usepackage[parfill]{parskip}
\setlength{\parskip}{8pt}

\usepackage{setspace}
\renewcommand*{\arraystretch}{1.25}

% Castel, figures. https://castel.dev/post/lecture-notes-2/
\usepackage{calc}
\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}

\newcommand{\ink}[3]{%
  \begin{figure}[H]
    \centering
    \def\svgscale{#2}
    \import{./figures/}{#1.pdf_tex}
    \caption{#3}
  \end{figure}
  \normalsize
}

\pgfplotsset{compat=1.16}
\usetikzlibrary{arrows}
\usepackage[geometry]{ifsym}
\usepackage{termcal}
\usepackage{pgfplots} % subplots
\usetikzlibrary{pgfplots.groupplots}
\pgfkeys{/pgf/number format/.cd,use comma}

\setbeamertemplate{subsection in toc}[subsections numbered]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \usepackage[demo]{graphicx}
\usepackage{subfig}

\AtBeginSection[]
{
    \begin{frame}
        \frametitle{Table of contents}
		% \tableofcontents[currentsection]
		
    \begin{columns}
    % \begin{minipage}[t][0.5\textheight]{0.95\textwidth}
    \begin{minipage}[t][0.85\textheight]{0.95\textwidth}
	  % \tableofcontents

	    \tableofcontents[currentsection]
    \end{minipage}\hfill
    \end{columns}

    \end{frame}
}

\usepackage{tikz}
\usepackage{algorithm}
\usepackage{algorithmic}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\arraystretch}{0.95}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\let\texteuro\euro
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\author[]{Josep Fanals}
\title[]{\large POWER SYSTEMS CALCULATION}
\institute{CITCEA}


\date{02/2021}
\frame{\titlepage}
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \begin{spacing}{2.5}

% \end{spacing}
\begin{frame}{Table of contents}
    \begin{columns}
    % \begin{minipage}[t][0.5\textheight]{0.95\textwidth}
    \begin{minipage}[t][0.85\textheight]{0.95\textwidth}
      \tableofcontents
    \end{minipage}\hfill
    \end{columns}
\end{frame}

\section{Holomorphic Embedding Load Flow Method (HELM)}
\subsection{Basics}
\begin{frame}{Basics}
Unkowns are no longer numbers as such, but series with an arbitrary number of coefficients. Multiple ways to embed the equations for the power flow. For example:
	\begin{equation}
		\sum_{j=1}^n Y_{ij}V_j(s) = s\frac{S^*_i}{V_i^*(s)}
	\end{equation}
	If we define $X_i(s)=1/V_i(s)$ and expand the series:
	\begin{equation}
		\begin{split}
		Y_{i1}&(V_1[0] + sV_1[1] +...+ s^cV_1[c]) \\
		+...+& Y_{ii}(V_i[0] + sV_i[1] +...+ s^cV_i[c])\\
		+...+& Y_{in}(V_n[0] + sV_n[1] +...+ s^cV_n[c]) = sS_i^*(X_i[0] + sX_i[1] +...+ s^{c-1}X_i[c-1])
		\end{split}
	\end{equation}
	This way we get to a linear system with a constant matrix. The coefficients to compute only depend on past terms!
\end{frame}


\subsection{Overview}
\begin{frame}{Overview}
	\ink{helm}{0.55}{Perspective of the HELM. Basic reffers to obtaining the final solution whereas the tools complement the results.}
\end{frame}


\subsection{Sigma approximants}
\begin{frame}{Sigma approximants}
\begin{itemize}
	\item Sigma plot of the IEEE30 system when active power changes.
	\item Sigma plot of the IEEE30 system when reactive power changes.
\end{itemize}	
\end{frame}

\subsection{GridCal}
\begin{frame}{GridCal}
	\begin{figure}
		\includegraphics[width=12.5cm]{figures/GridCal.png}
		\caption{General view of GridCal with its GUI}
	\end{figure}
\end{frame}



\section{Flexible General Branch Model (FGBM)}
\subsection{Modelling}
\begin{frame}{Modelling}
	We are interested in a generic model for power lines, transformers and converters.
	\begin{figure}
		\includegraphics[width=6cm]{figures/fgbm.PNG}
		\caption{Flexible General Branch Model to model any element. Reference: Bustos, A. A. and Kazemtabrizi, B. (2018) 'Flexible general branch model unified power flow algorithm for future flexible AC/DC networks.' in 2018 IEEE International Conference on Environment and Electrical Engineering and 2018 IEEE Industrial and Commercial Power Systems Euroope (EEEIC / ICPS Europe): 12-15 June 2018, Palermo, Italy. Conference proceedings. Piscataway, NJ: IEEE.}
	\end{figure}
	\begin{table}\footnotesize
		\begin{tabular}{cc} 
			\hline
			Variable & Control \\
			\hline
			$\theta_{sh}$ & $\theta_{sh}$ \\
			$\theta_{sh}$ & $P_f$ \\
			$m_a$ & $v_t$ \\
			$m_a$ & $Q_t$ \\
			$B_{eq}$ & $v_{dc}$ \\
			$B_{eq}$ & \text{Zero} $Q$ \text{constraint}\\
			\hline 
		\end{tabular}
		\hspace{1cm}
		\begin{tabular}{cccc}
			\hline
			Mode & Constraint 1 & Constraint 2 & VSC control\\
			\hline
			1 & $\theta_{sh}$ & $v_{ac}$ & I\\
			2 & $P_f$ & $Q_{ac}$ & I\\
			3 & $P_f$ & $v_{ac}$ & I\\
			\hline
			4 & $v_{dc}$ & $Q_{ac}$ & II\\
			5 & $v_{dc}$ & $v_{ac}$ & II\\
			\hline
			6 & $v_{dc}$ droop & $Q_{ac}$ & III\\
			7 & $v_{dc}$ droop & $v_{ac}$ & III\\
			\hline
		\end{tabular}
		\caption{VSC control models and relationship between the variables and the controlled magnitude}
	\end{table}	
	
\end{frame}

\subsection{FGBM + HELM}
\begin{frame}{FGBM + HELM}
	\begin{figure}
		\includegraphics[width=5cm]{figures/converter.pdf}
		\includegraphics[width=5cm]{figures/conv2.pdf}
		\caption{Left: simple system with a VSC converter. Right: maximum error depending on the number of coefficients in the series.}
	\end{figure}
	One embedded equation becomes for instance:
	\begin{equation}
		I_f(s) = y_sV_2(s) - y_sV_1(s) + sj\frac{b_c}{2}V_2(s) + sjB_{eq} V_2(s) + sGI_f^{re}(s)I_f^{re}(s)I_f^{im}(s)I_f^{im}(s)V_2(s)
	\end{equation}
	HELM is also suitable to solve rather complicated equations like this one.
\end{frame}

\section{Alternating Search Directions (ASD)}
\subsection{Formulation}
\begin{frame}{Formulation}
	We define the problem in two steps.
	\begin{itemize}
		\item Admittances side:
	\end{itemize}
	\begin{equation}
		\begin{cases}
			I^{l+\frac{1}{2}}-I^{l} = \alpha(V^{l+\frac{1}{2}} - V^l),\\
			YV^{l+\frac{1}{2}} = I_0 + I^{l+\frac{1}{2}}. 
		\end{cases}
	\end{equation}
	\begin{itemize}
		\item Load/generator side:
	\end{itemize}
	\begin{equation}
		\begin{cases}
			I^{l+1} - I^{l+\frac{1}{2}} = \beta(V^{l+1} - V^{l+\frac{1}{2}}),\\
			(V^{l+1})^*I^{l+1}=S^*.
		\end{cases}
	\end{equation}
	Matrices $\alpha$ and $\beta$ can be arbitrarily defined, but for instance:
	\begin{equation}
		\begin{cases}
			\alpha = \text{diag}(S^*/|V|^2),\\
			\beta = \text{diag}(Y+\alpha).
		\end{cases}
	\end{equation}
	These are constant matrices. Contrary to the typical NR, there are no inverses as such (expensive computation with $\mathcal{O}(n^3)$).
	%complexity!
\end{frame}


\section{Proper Generalised Decomposition (PGD)}
\subsection{Multidimensional power flow}
\begin{frame}{Multidimensional power flow}
	\begin{itemize}
		\item Dimensions: position (nodes), changes in power, time...
		\item Voltages expressed in the separated form: $V(x,q,t)=\sum_{m=1}^M V_m \otimes Q_m \otimes T_m$. 
	\end{itemize}

\ink{cube1}{0.6}{Representation of the cube of solutions}

	\begin{itemize}
\item Need to compute $M (n_{\text{buses}} + n_{\text{powers}} + n_{\text{time}})$ instead of $n_{\text{buses}} \cdot n_{\text{powers}} \cdot n_{\text{time}}$ unknowns. 

\item Can it be adapted for changes in the topology so that we can employ it for contingency analysis ($N-1$, $N-2$...)?
	\end{itemize}
\end{frame}

\subsection{Algorithm PGD + ASD}
\begin{frame}{Algorithm}
The outer loop follows the ASD procedure while the inner one is based on the alternating directions technique.
\begin{algorithm}[H]
\begin{algorithmic}[1]
\FOR{$\gamma=1$ to $N_\gamma$}
\STATE Compute power side of the problem with PGD: $I=S^* \oslash V^{*[\gamma]}$
\FOR{$m=1$ to $M$}
\STATE Define $I=\sum_{m=1}^{M-1} I_m \otimes Q_m \otimes T_m + I_M \otimes Q_M \otimes T_M$
\FOR{$k=1$ to $N_k$}
\STATE Compute $I_M^{[k+1]}$ with $Q_M^{[k]}$ and $T_M^{[k]}$.   
\STATE Compute $Q_M^{[k+1]}$ with $I_M^{[k+1]}$ and $T_M^{[k]}$.   
\STATE Compute $T_M^{[k+1]}$ with $I_M^{[k+1]}$ and $Q_M^{[k+1]}$.   
\ENDFOR
\ENDFOR
\STATE Compute admittances side of the problem directly: $V^{[\gamma+1]}=Y^{-1}(I+I_0)$.
\ENDFOR
\end{algorithmic}
\caption{Pseudocode for the PGD combined with ASD}
\label{alg:seq}
\end{algorithm}
\vspace{-0.5cm}
\begin{itemize}
	\item Show code and results.
\end{itemize}
\end{frame}
	


\frame{\titlepage}


\end{document}

