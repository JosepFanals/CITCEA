\documentclass[10pt]{article}

\usepackage[left=30mm, right=30mm]{geometry}
%\usepackage[scale=4]{draftwatermark}

\usepackage[backend=biber, sorting=none]{biblatex} % per la bibliografia
\setlength\bibitemsep{\baselineskip} % per tenir mÃ©s espai entre bibliografia
\addbibresource{bib.bib} % carregar el fitxer de bibliografia
\usepackage{bm}
\usepackage{amsmath}
\usepackage[activate={true, noncompatibility}]{microtype}
\usepackage{tikz}
\usepackage{circuitikz}
\usepackage{amssymb}
\usepackage{diagbox}
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}

\begin{document}

\begin{center}
    \Large
    \textbf{Positive and negative sequence currents to increase voltages during unbalanced faults}
         
    \vspace{0.4cm}
    \textbf{Josep Fanals}
       
       
    \vspace{0.4cm}
    \textbf{02/2021}
\end{center}

\section{Introduction}
Grid faults constitute a group of unfortunate events that cause severe perturbations in the grid. The voltages can take values below the established minimum, or on the contrary, exceed the maximum in non-faulted phases. The currents are also susceptible to vary considerably. Traditional power systems based on synchronous generators could experiment currents surpassing the nominal values, and therefore, the fault could be clearly detected. However, the increasing integration of renewables \cite{anees2012grid} supposes a change of paradigm, in which currents can be controlled but they are limited so as not to damage the Isolated-Gate Bipolar Transistors (IGBT) found in the Voltage Source Converter (VSC) \cite{abdou2013improving}. 

Transmission System Operators (TSO) are responsible for imposing requirements related to the operation under voltage sags to generators and converters \cite{tsili2009review, iov2007mapping}. Such requirements are gathered in the respective grid codes. There seems to be no clear consensus on how to restore the voltage. In this sense, even if for instance the Low Voltage Ride Through (LVRT) profiles present similarities \cite{conroy2007low}, analysis aimed at determining analytically the optimal injection of positive and negative sequence currents are not numerous. As far as the author is aware, only Camacho et al. offer an optimal solution regarding the injection of active and reactive powers \cite{camacho2017positive}. 

Consequently, this work focuses on finding the most convenient positive and negative sequence currents (and not powers) to raise the voltage at the point of common coupling. First, a simple modelling is discussed, and then, the results are shown together with the corresponent discussion. The challenge to solve the optimization problem in a closed form is specially described.

\section{Modelling}
Given a simplistic three-wire system formed by two buses, it can be studied separately employing the concept of symmetrical components. Figure \ref{fig:sys_p} shows the positive and negative sequence equivalent circuits. Note that no homopolar component is considered here, since in a system without neutral they are inexistent \cite{rodriguez2006independent, camacho2012flexible}.

\begin{figure}[!htb] \centering
\begin{circuitikz}[european]
\thicklines

\draw (0,0) to [sV, v_=$\underline{V}^-_z$] (0,2);
\draw (-3,2) to [R, l=$\underline{Z}^-_z$, i=$\underline{I}^-$, *-] (0,2);
\draw (-0.25,0) to [short] (0.25,0);
\node at (-3,1.7) {PCC};
\node at (-3,2.3) {$\underline{V}^-_c$};

\draw (-7,0) to [sV, v_=$\underline{V}^+_z$] (-7,2);
\draw (-10,2) to [R, l=$\underline{Z}^+_z$, i=$\underline{I}^+$, *-] (-7,2);
\draw (-7.25,0) to [short] (-6.75,0);
\node at (-10,1.7) {PCC};
\node at (-10,2.3) {$\underline{V}^+_c$};

\end{circuitikz}
\caption{Positive and negative sequence separated representations of the two-bus system}
\label{fig:sys_p}
\end{figure}
The point of common coupling (PCC) is where the VSC together with its filter would be connected. There are two restrictions to take into account in a VSC, one related to the maximum current and another to the voltage. The current limitation is likely the most relevant when operating under faults. Since the current is limited and the filter used to connect the VSC to the PCC takes rather low values, we can expect the voltage drop to not be substantial. Because of that, and taking into consideration the voltage sag at the grid side, the voltage limit is hardly ever surpassed. Thus, in the analysis that follows, we only impose the current restriction. In a future work we could also add the voltage limitations as a constraint, although probably the conclusions will not vary from the ones extracted here.

Considering that voltages $\underline{V}^+_z$ and $\underline{V}^-_z$ are given in order to model the fault suffered at the grid, the first step is to express the voltages at the PCC ($\underline{V}^+_c$ and $\underline{V}^-_c$) as a function of the injected currents $\underline{I}^+$ and $\underline{I}^-$. These currents are provided by the VSC with the objective of raising the positive sequence voltage and reducing the negative sequence voltage. The strategy to choose can take many forms. For instance, in \cite{camacho2017positive}, three strategies are detailed. One consists of increasing the positive sequence voltage as much as possible, another tried to reduce the negative sequence voltage, and a third one was concerned with obtaining the maximum difference between the positive and the negative sequence voltages. Even though this last one seems the most interesting one, we could improve its flexibility. We will soon see what this means.

Before developing the expressions, some intuition can be provided. We will assume the impedances $\underline{Z}^+_z$ and $\underline{Z}^-_z$ to be equal, with a small $R/X$ ratio. We can also expect that the voltages present a small phase. Hence, to boost the positive sequence voltage at the PCC, the converter should inject a delayed reactive current with respect to the voltage. So in all likelihood, the imaginary part of the current ought to take a negative value. When it comes to the negative sequence voltage, the reactive current should be positive. This way, there is a negative voltage drop so that $\underline{V}^-_c$ becomes smaller than $\underline{V}^-_z$ in magnitude.

For convenience, the currents are expressed as:
\begin{equation}
    \begin{cases}
        \underline{I}^+ = I^+_{re} - j I^+_{im},\\
        \underline{I}^- = I^-_{re} + j I^-_{im}.\\
    \end{cases}
    \label{eq:curr}
\end{equation}
Notice the difference in signs in the imaginary part, as we expect $I^+_{im}$ and $I^-_{im}$ to take positive values. In any case, these definitions could be expressed the other way around without loss of generality. By Kirchoff's law, the absolute value of the voltages at the PCC becomes:
\begin{equation}
    \begin{cases}
        V^+_c = RI^+_{re} + XI^+_{im} + \sqrt{|\underline{V}^+_z|^2 - (XI^+_{re} - RI^+_{im})^2},\\
        V^-_c = RI^-_{re} - XI^-_{im} + \sqrt{|\underline{V}^-_z|^2 - (XI^-_{re} + RI^-_{im})^2},\\
    \end{cases}
    \label{eq:VV}
\end{equation}
where $R$ and $X$ are the real and imaginary part of $\underline{Z}_z$ respectively (both for positive and negative sequence). As expected, the positive sequence voltage only depends on the positive sequence current, and the same applies for the negative sequences. Despite not finding a coupling between sequences in Equation \ref{eq:VV}, there is indeed a trade-off situation. The challenge comes when having to choose the currents under the restriction that none of the $abc$ currents can surpass the maximum imposed by the IGBTs. For instance, using a null negative sequence current means we can increase the positive sequence voltage, but unfortunately, the negative sequence voltage will be the same as in the grid. Maybe it is more appropriate to balance the currents, so some of the VSC capacity is used to increase the positive sequence voltage, and another part to diminish the negative sequence voltage. As it will be shown in the results, this balanced situation becomes the most sound option. 

There are at least a couple of ways to find the optimal currents. One way is to brute force it; to calculate multiple combinations of $I^+_{re}$, $I^+_{im}$, $I^-_{re}$ and $I^-_{im}$ values in order to obtain solution in which the difference between positive and negative sequence voltage is maximized. Opting for this possibility can become time-consuming. Besides, we can only pick the solutions where the current limit is not met.

A neat way to approach the optimization problem under constraints is to define a Lagrangian. This is based on the one hand on the objective function
\begin{equation}
    f(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}) = \lambda_+V^+_c(I^+_{re}, I^+_{im}) - \lambda_-V^-_c(I^-_{re}, I^-_{im}),
\end{equation}
where $\lambda_+$ and $\lambda_- \in \mathbb{R}$. In principle, both parameters take positive values if the goal is to increase the positive sequence voltage and reduce the negative sequence one. In any case, this formulation allows us to be flexible, in a way that we can prioritize one voltage over the other by the factor we desire. 

On the other hand, in this particular case the Lagrangian takes into account the constraint
\begin{equation}
    g(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}) = \text{max}(I_a(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}), I_b(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}), I_c(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im})).
\end{equation}
The $abc$ currents are related to the real and imaginary parts of the positive and negative sequence by Fortescue's transformation:
\begin{equation}
    \begin{bmatrix}
        \underline{I}_a\\
        \underline{I}_b\\
        \underline{I}_c
    \end{bmatrix} =
    \begin{bmatrix}
        1 & 1 & 1\\ 
        1 & a^2 & a\\
        1 & a & a^2
    \end{bmatrix}
    \begin{bmatrix}
        0\\
        I^+_{re} - jI^+_{im}\\
        I^-_{re} + jI^-_{im}\\
    \end{bmatrix},
\end{equation}
where $a=e^{j2\pi/3}$. By developing this, the absolute value of the currents result in
\begin{equation}
    \begin{cases}
        |\underline{I_a}|^2 = I^{2+}_{re} + I^{2-}_{re} + I^{2+}_{im} + I^{2-}_{im} + 2I^{+}_{re}I^{-}_{re} - 2I^{+}_{im}I^{-}_{im},\\
        |\underline{I_b}|^2 = I^{2+}_{re} + I^{2-}_{re} + I^{2+}_{im} + I^{2-}_{im} - I^{+}_{re}I^{-}_{re} + \sqrt{3}I^+_{re}I^-_{im} + \sqrt{3}I^-_{re}I^+_{im} + I^+_{im}I^-_{im},\\
        |\underline{I_c}|^2 = I^{2+}_{re} + I^{2-}_{re} + I^{2+}_{im} + I^{2-}_{im} - I^{+}_{re}I^-_{re} - \sqrt{3}I^+_{re}I^-_{im} - \sqrt{3}I^-_{re}I^+_{im} + I^+_{im}I^-_{im}.
    \end{cases}
\end{equation}
The Lagrangian takes the generic form as follows:
\begin{equation}
    \mathcal{L}(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}, \lambda) = f(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}) - \lambda g(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}),
\end{equation}
where $\lambda$ is the Langrange multiplier and has nothing to do with $\lambda_+$ or $\lambda_-$. The optimal solution comes from computing the gradient and setting it equal to the null vector:
\begin{equation}
    \nabla \mathcal{L}(I^+_{re}, I^+_{im}, I^-_{re}, I^-_{im}, \lambda) = \left(\frac{\partial \mathcal{L}}{\partial I^+_{re}}, \frac{\partial \mathcal{L}}{\partial I^+_{im}}, \frac{\partial \mathcal{L}}{\partial I^-_{re}}, \frac{\partial \mathcal{L}}{\partial I^-_{im}},  \frac{\partial \mathcal{L}}{\partial \lambda}, \right)^T = \mathbf{0}.
    \label{eq:lag}
\end{equation}
For now, I have not been able to solve in closed form the solutions to Equation \ref{eq:lag}. Even though they probably have a solution, first of all they are non-linear, and even if we linearize them and iterate, the matrix of the system becomes ill-conditioned. Due to this, the equations regarding the Lagrangian are expanded in the annex A but they will not be used to compute the results. As a future work, it would be interesting to check if the results match with either methodology.

\section{Results and discussion}
The following results are computed with brute force. That is, the four unknown currents take multiple values and we have to evalute the objective function for every combination. As discussed, this objective function can take many forms but for now it will be $V^{+}_c - V^{-}_c$. 

The solution is expected to vary depending on the voltages at the grid and its impedance, as Equation \ref{eq:VV} would suggest. Thus, to get a general picture of the influence of the optimal injected currents, diverse values for $V^+_z$ and $V^-_z$ will be taken, and the same applies to $R$ and $X$. Unless otherwise indicated, $V^+=0.8$, $V^-_z=0.1$, $R=0.01$, $X=0.1$ and $I_{max}=1$. To have representative results, six tables are shown (from Table \ref{tab:vv} to Table \ref{tab:vnx}). They describe what the optimal $[I^+_{re},I^+_{im},I^-_{re},I^-_{im}]$ vector is according to various combinations. Currents vary in intervals of 0.05. These interval could be smaller, but the computational time would increase dramatically. Therefore, it serves the purpose to provide us with an approximate idea of the optimal solution.

\begin{table}[!htb]
  \centering
  \caption{Optimal currents $[I^+_{re},I^+_{im},I^-_{re},I^-_{im}]$ with variations in $V^+_z$ and $V^-_z$}
    \begin{tabular}{|r|llll|}
        \hline
    \diagbox[width=1.5cm, height=0.7cm]{$V^+_z$}{$V^-_z$} & {0.05} & {0.1} & {0.15} & {0.3} \\
    \hline
    0.4   & 0.00;0.65;0.00;0.50 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 \\
    0.6   & 0.00;0.65;0.00;0.50 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 \\
    0.8   & 0.00;0.65;0.00;0.50 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 \\
    0.9   & 0.00;0.65;0.00;0.50 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 \\
    \hline
    \end{tabular}%
  \label{tab:vv}%
\end{table}%

\begin{table}[!htb]
  \centering
  \caption{Optimal currents $[I^+_{re};I^+_{im};I^-_{re};I^-_{im}]$ with variations in $R$ and $X$}
    \begin{tabular}{|r|llll|}
        \hline
    \diagbox[width=1.5cm, height=0.7cm]{$R$}{$X$} & {0.03} & {0.06} & {0.1} & {0.2} \\
    \hline
    0.01  & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 \\
    0.02  & 0.30;0.40;-0.40;0.50 & 0.20;0.45;-0.25;0.60 & 0.15;0.55;-0.15;0.55 & 0.00;0.65;0.00;0.50 \\
    0.05  & 0.40;0.30;-0.50;0.40 & 0.40;0.50;-0.30;0.40 & 0.20;0.45;-0.25;0.60 & 0.15;0.65;-0.10;0.45 \\
    0.1   & 0.40;0.10;-0.70;0.15 & 0.40;0.30;-0.50;0.40 & 0.30;0.40;-0.40;0.50 & 0.25;0.65;-0.15;0.40 \\
    \hline
    \end{tabular}%
  \label{tab:rx}%
\end{table}%

\begin{table}[!htb]
  \centering
  \caption{Optimal currents $[I^+_{re};I^+_{im};I^-_{re};I^-_{im}]$ with variations in $V^+_z$ and $R$}
    \begin{tabular}{|r|llll|}
        \hline
    \diagbox[width=1.5cm, height=0.7cm]{$V^+_z$}{$R$} & {0.01} & {0.02} & {0.05} & {0.1} \\
    \hline
    0.4   & 0.00;0.50;0.00;0.65 & 0.15;0.55;-0.15;0.55 & 0.20;0.45;-0.25;0.60 & 0.30;0.40;-0.40;0.50 \\
    0.6   & 0.00;0.50;0.00;0.65 & 0.15;0.55;-0.15;0.55 & 0.20;0.45;-0.25;0.60 & 0.30;0.40;-0.40;0.50 \\
    0.8   & 0.00;0.50;0.00;0.65 & 0.15;0.55;-0.15;0.55 & 0.20;0.45;-0.25;0.60 & 0.30;0.40;-0.40;0.50 \\
    0.9   & 0.00;0.50;0.00;0.65 & 0.15;0.55;-0.15;0.55 & 0.20;0.45;-0.25;0.60 & 0.30;0.40;-0.40;0.50 \\
    \hline
    \end{tabular}%
  \label{tab:vpr}%
\end{table}%

\begin{table}[!htb]
  \centering
  \caption{Optimal currents $[I^+_{re};I^+_{im};I^-_{re};I^-_{im}]$ with variations in $V^+_z$ and $X$}
    \begin{tabular}{|r|llll|}
    \hline
     \diagbox[width=1.5cm, height=0.7cm]{$V^+_z$}{$X$} & {0.03} & {0.06} & {0.1} & {0.2} \\
    \hline
    0.4   & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.65;0.00;0.50 \\
    0.6   & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.65;0.00;0.50 \\
    0.8   & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.65;0.00;0.50 \\
    0.9   & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.65;0.00;0.50 \\
    \hline
    \end{tabular}%
  \label{tab:vpx}%
\end{table}%

\begin{table}[!htb]
  \centering
  \caption{Optimal currents $[I^+_{re};I^+_{im};I^-_{re};I^-_{im}]$ with variations in $V^-_z$ and $R$}
    \begin{tabular}{|r|llll|}
        \hline
    \diagbox[width=1.5cm, height=0.7cm]{$V^-_z$}{$R$} & {0.01} & {0.02} & {0.05} & {0.1} \\
    \hline
    0.05  & 0.00;0.65;0.00;0.50 & 0.15;0.70;-0.10;0.40 & 0.25;0.65;-0.15;0.40 & 0.45;0.60;-0.20;0.30 \\
    0.1   & 0.00;0.50;0.00;0.65 & 0.15;0.55;-0.15;0.55 & 0.20;0.45;-0.25;0.60 & 0.30;0.40;-0.40;0.50 \\
    0.15  & 0.00;0.50;0.00;0.65 & 0.15;0.55;-0.15;0.55 & 0.20;0.45;-0.25;0.60 & 0.30;0.40;-0.40;0.50 \\
    0.3   & 0.00;0.50;0.00;0.65 & 0.15;0.55;-0.15;0.55 & 0.20;0.45;-0.25;0.60 & 0.30;0.40;-0.40;0.50 \\
    \hline
    \end{tabular}%
  \label{tab:vnr}%
\end{table}%

\begin{table}[!htb]
  \centering
  \caption{Optimal currents $[I^+_{re};I^+_{im};I^-_{re};I^-_{im}]$ with variations in $V^-_z$ and $X$}
    \begin{tabular}{|r|llll|}
    \hline
     \diagbox[width=1.5cm, height=0.7cm]{$V^-_z$}{$X$}    & {0.03} & {0.06} & {0.1} & {0.2} \\
    \hline
    0.05  & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.65;0.00;0.50 & 0.00;0.85;0.00;0.25 \\
    0.1   & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.65;0.00;0.50 \\
    0.15  & 0.25;0.60;-0.20;0.45 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 \\
    0.3   & 0.20;0.45;-0.25;0.60 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 & 0.00;0.50;0.00;0.65 \\
    \hline
    \end{tabular}%
  \label{tab:vnx}%
\end{table}%
The results suggest that the optimal currents do not vary much when the voltages at the grid change. Even though only a small subset of voltages have been studied, it can be foreseen that the optimality in currents may not be strongly linked to the fault. Substantial variations take place when the impedance of the grid is altered. When it becomes mainly resistive, real positive and negative sequence currents have to be injected. In fact, real positive sequence currents become positive to cause a positive voltage drop and increase $V^+_c$, whereas the real positive negative sequence currents turn out to be negative in order to decrease $V^-_c$. Once the impedance is more inductive, imaginary positive and negative sequence have to be injected. Notice that $I^+_{im}$ is greater than 0 due to the way it has been defined in Equation \ref{eq:curr}; so in reality, it becomes negative. The $I^-_{im}$ current takes positive values, which makes sense considering that it has to produce a negative voltage drop to decrease the negative sequence voltage at the PCC.

It is valuable to plot the evolution of currents against the $R/X$ ratio, or rather, leave $R$ constant at 0.1 and vary $X$ from 0.01 to 0.4 in steps of 0.01. The result is plotted in Figure \ref{fig:Ip}. 

\begin{figure}[!htb] \centering
        \begin{tikzpicture}
            \pgfplotsset{width=12cm, height=6cm}
            \begin{axis}[grid=major, xlabel={$X$ (pu)}, ylabel={Current (pu)}, /pgf/number format/.cd, xtick={0,0.05,...,0.4}, ytick={-1, -0.8,...,1.0}, xmin=0, xmax=0.4, /pgf/number format/.cd, legend style={at={(1.02,0.15)},anchor=south west,legend columns=1, draw=none, inner sep=0pt,fill=gray!10}]
            \addplot[very thick, gray, dashed] table[x=x, y=y, col sep=semicolon] {Data/Ipre.csv};
            \addplot[very thick, gray] table[x=x, y=y, col sep=semicolon] {Data/Ipim.csv};
            \addplot[very thick, black, dashed] table[x=x, y=y, col sep=semicolon] {Data/Inre.csv};
            \addplot[very thick, black] table[x=x, y=y, col sep=semicolon] {Data/Inim.csv};
            \legend{$I^+_{re}$, $I^+_{im}$, $I^-_{re}$, $I^-_{im}$}
            \end{axis}
        \end{tikzpicture}
    \vfill
    \caption{Evolution of currents depending on $X$ for $R=0.1$, $V^+_z=0.8$ and $V^-_z=0.1$}
    \label{fig:Ip}
\end{figure}
Figure \ref{fig:Ip} reveals the somewhat caothic profile of the currents. The plots suggest that the rudimentary optimization technique may not be the best choice, as currents do not follow continuous trends. Take for instance $I^-_{im}$; for small values of $X$ it grows, and then, the trend is reversed. Employing an optimization methodology like the presented Lagrangian could probably generate finer results. Figure \ref{fig:Ip} also suggests that $I^+_{im}$ ought to take considerably higher values than $I^-_{im}$, even though in the previous analysis (shown in Tables from \ref{tab:vv} to \ref{tab:vnx}) they were more balanced. The only difference is that now $R=0.1$. 

In any case, a similar pattern as before is discovered. The real positive sequence current takes positive values but it approaches zero when $X>>R$. On the other side, initially the real negative sequence current becomes smaller than zero. As it has been discussed, the signs make sense when taking into account the objective function to increase the positive sequence voltage while decreasing the negative sequence one. For the imaginary part of the currents, only the positive sequence grows. The other, remains more or less constant at around 0.3.

The final study we carry has to do with varying the negative sequence voltage. We have observed that when the negative sequence voltage tends to grow, both imaginary positive and negative sequence currents have to be injected in a more or less balanced way, while the real parts come close to zero. However, when the negative sequence voltage remains close to zero, this is not exactly the case. Figure \ref{fig:Vn} shows the evolution of the currents when modifying $V^-_z$.

\begin{figure}[!htb] \centering
        \begin{tikzpicture}
            \pgfplotsset{width=12cm, height=6cm}
            \begin{axis}[grid=major, xlabel={$V^-_z$ (pu)}, ylabel={Current (pu)}, /pgf/number format/.cd, xtick={0,0.01,...,0.07}, ytick={-1, -0.8,...,1.0}, xmin=0, xmax=0.07, /pgf/number format/.cd, legend style={at={(1.02,0.15)},anchor=south west,legend columns=1, draw=none, inner sep=0pt,fill=gray!10}]
            \addplot[very thick, gray, dashed] table[x=x, y=y, col sep=semicolon] {Data/Ipre2.csv};
            \addplot[very thick, gray] table[x=x, y=y, col sep=semicolon] {Data/Ipim2.csv};
            \addplot[very thick, black, dashed] table[x=x, y=y, col sep=semicolon] {Data/Inre2.csv};
            \addplot[very thick, black] table[x=x, y=y, col sep=semicolon] {Data/Inim2.csv};
            \legend{$I^+_{re}$, $I^+_{im}$, $I^-_{re}$, $I^-_{im}$}
            \end{axis}
        \end{tikzpicture}
    \vfill
    \caption{Evolution of currents depending on $V^-_z$ for $R=0.01$, $X=0.1$ and $V^+_z=0.5$}
    \label{fig:Vn}
\end{figure}
When the negative sequence voltage is practically null, the most convenient strategy is to increase the positive sequence voltage at the PCC with $I^+_{im}$. There is no point in reducing the negative sequence voltage because it is already small. Once this tends to increase, the real part of the currents remain close to zero. However, the imaginary part of both the positive and negative sequence currents evolves towards an equilibrium, where $I^+_{im}\approx I^-_{im}$. This was also visible in Table \ref{tab:vv}.


\section{Conclusions}
The theoretical side of this work has shown that the optimization problem poses some challenges, mainly because of the maximum current limitation. A Lagrangian has been developed, although the equations involved remain to be solved in closed form. Computing the results in a brute force manner shows that the solutions is likely to be more well refined if it had been computed by other means, but nonetheless, some interesting observations can be made.

One of them is that both positive and negative sequence currents are convenient when trying to maximize the difference between the positive and the negative sequence voltages. More concretely, the imaginary parts of these currents tend to be larger than its real part. Moreover, the signs of the currents make sense, meaning that the real part of the positive sequence current becomes positive, its imaginary part negative (although it has been defined initially as positive); on the other hand, the real part of the negative sequence current is usually close to zero but negative, while its imaginary part takes positive values. 

Future work regarding computation of the solution with some optimization technique will probably be able to generate slightly more satisfactory results obtained much faster. The Lagrangian may be an appropriate pick. Also, a further step would consist of defining active and reactive powers as a function of voltages and currents. Once this is accomplished, I believe we could proceed towards a real case scenario.


\newpage
\appendix
\section{Lagrangian}
It is not straightforward to know beforehand which $abc$ current will be the maximum. Therefore, I see no other option than to develop the Lagrangian for all three cases, that is, assuming that either $I_a$ or $I_b$ or $I_c$ is the maximum.

If $I_a$ is the maximum current:
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^+_{re}} &= \lambda_+R + \lambda_+\frac{1}{2}\left(V^{+2}_z - X^2I^{+2}_{re} - R^2I^{+2}_{im} + 2XRI^{+}_{re}I^{+}_{im} \right)^{1/2}\left(-2X^2I^{+}_{re} + 2XRI^{+}_{im}\right)\\
    & + \lambda\left(-2 I^{+}_{re} -2I^{-}_{re} \right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^+_{im}} &= \lambda_+X + \lambda_+\frac{1}{2}\left(V^{+2}_z - X^2I^{+2}_{re} - R^2I^{+2}_{im} + 2XRI^{+}_{re}I^{+}_{im} \right)^{1/2}\left(-2R^2I^{+}_{im} + 2XRI^{+}_{re}\right)\\
    & + \lambda\left(-2I^{+}_{im} + 2I^{-}_{im}\right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^-_{re}} &= -\lambda_-R - \lambda_-\frac{1}{2}\left(V^{-2}_z - R^2I^{-2}_{im} - X^2I^{-2}_{re} - 2RXI^-_{re}I^-_{im} \right)^{1/2}\left(-2X^2I^{-}_{re} - 2XRI^{-}_{im}\right)\\
    & +\lambda\left(- 2I^{-}_{re} -2  I^{+}_{re} \right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^-_{im}} &= \lambda_-X - \lambda_-\frac{1}{2}\left(V^{-2}_z - R^2I^{-2}_{im} - X^2I^{-2}_{re} - 2RXI^-_{re}I^-_{im} \right)^{1/2}\left(-2R^2I^{-}_{im} - 2XRI^{-}_{re}\right)\\
    & +\lambda\left(-2 I^{-}_{im} + 2 I^{+}_{im}\right),
    \end{split}
\end{equation}
\begin{equation}
    \frac{\partial \mathcal{L}}{\partial \lambda} = -(I^{2+}_{re} + I^{2-}_{re} + I^{2+}_{im} + I^{2-}_{im} + 2I^{+}_{re}I^{-}_{re} - 2I^{+}_{im}I^{-}_{im}) + I^2_{max}.
\end{equation}

If $I_b$ is the maximum current:
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^+_{re}} &= \lambda_+R + \lambda_+\frac{1}{2}\left(V^{+2}_z - X^2I^{+2}_{re} - R^2I^{+2}_{im} + 2XRI^{+}_{re}I^{+}_{im} \right)^{1/2}\left(-2X^2I^{+}_{re} + 2XRI^{+}_{im}\right)\\
      &+ \lambda\left(-2 I^{+}_{re} + I^{-}_{re} -\sqrt{3}  I^{-}_{im}\right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^+_{im}} &= \lambda_+X + \lambda_+\frac{1}{2}\left(V^{+2}_z - X^2I^{+2}_{re} - R^2I^{+2}_{im} + 2XRI^{+}_{re}I^{+}_{im} \right)^{1/2}\left(-2R^2I^{+}_{im} + 2XRI^{+}_{re}\right)\\
    &+\lambda\left(-2 I^{+}_{im} - \sqrt{3} I^{-}_{re} - I^{-}_{im} \right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^-_{re}} &= -\lambda_-R - \lambda_-\frac{1}{2}\left(V^{-2}_z - R^2I^{-2}_{im} - X^2I^{-2}_{re} - 2RXI^-_{re}I^-_{im} \right)^{1/2}\left(-2X^2I^{-}_{re} - 2XRI^{-}_{im}\right)\\
    &+\lambda\left(-2 I^{-}_{re} + I^{+}_{re} - \sqrt{3} I^{+}_{im}\right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^-_{im}} &= \lambda_-X - \lambda_-\frac{1}{2}\left(V^{-2}_z - R^2I^{-2}_{im} - X^2I^{-2}_{re} - 2RXI^-_{re}I^-_{im} \right)^{1/2}\left(-2R^2I^{-}_{im} - 2XRI^{-}_{re}\right)\\
    &+\lambda\left(-2 I^{-}_{im} - \sqrt{3}  I^{+}_{re} -  I^{+}_{im}\right)   ,
    \end{split}
\end{equation}
\begin{equation}
    \frac{\partial \mathcal{L}}{\partial \lambda} = -(I^{2+}_{re} + I^{2-}_{re} + I^{2+}_{im} + I^{2-}_{im} - I^{+}_{re}I^{-}_{re} + \sqrt{3}I^+_{re}I^-_{im} + \sqrt{3}I^-_{re}I^+_{im} + I^+_{im}I^-_{im}) + I^2_{max}.
\end{equation}
If $I_c$ is the maximum current:
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^+_{re}} &= \lambda_+R + \lambda_+\frac{1}{2}\left(V^{+2}_z - X^2I^{+2}_{re} - R^2I^{+2}_{im} + 2XRI^{+}_{re}I^{+}_{im} \right)^{1/2}\left(-2X^2I^{+}_{re} + 2XRI^{+}_{im}\right)\\
      &+ \lambda\left(-2 I^{+}_{re} + I^{-}_{re} +\sqrt{3}  I^{-}_{im}\right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^+_{im}} &= \lambda_+X + \lambda_+\frac{1}{2}\left(V^{+2}_z - X^2I^{+2}_{re} - R^2I^{+2}_{im} + 2XRI^{+}_{re}I^{+}_{im} \right)^{1/2}\left(-2R^2I^{+}_{im} + 2XRI^{+}_{re}\right)\\
    &+\lambda\left(-2 I^{+}_{im} + \sqrt{3} I^{-}_{re} - I^{-}_{im} \right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^-_{re}} &= -\lambda_-R - \lambda_-\frac{1}{2}\left(V^{-2}_z - R^2I^{-2}_{im} - X^2I^{-2}_{re} - 2RXI^-_{re}I^-_{im} \right)^{1/2}\left(-2X^2I^{-}_{re} - 2XRI^{-}_{im}\right)\\
    &+\lambda\left(-2 I^{-}_{re} + I^{+}_{re} + \sqrt{3} I^{+}_{im}\right),
    \end{split}
\end{equation}
\begin{equation}
    \begin{split}
    \frac{\partial \mathcal{L}}{\partial I^-_{im}} &= \lambda_-X - \lambda_-\frac{1}{2}\left(V^{-2}_z - R^2I^{-2}_{im} - X^2I^{-2}_{re} - 2RXI^-_{re}I^-_{im} \right)^{1/2}\left(-2R^2I^{-}_{im} - 2XRI^{-}_{re}\right)\\
    &+\lambda\left(-2 I^{-}_{im} + \sqrt{3}  I^{+}_{re} -  I^{+}_{im}\right)   ,
    \end{split}
\end{equation}
\begin{equation}
    \frac{\partial \mathcal{L}}{\partial \lambda} = -(I^{2+}_{re} + I^{2-}_{re} + I^{2+}_{im} + I^{2-}_{im} - I^{+}_{re}I^-_{re} - \sqrt{3}I^+_{re}I^-_{im} - \sqrt{3}I^-_{re}I^+_{im} + I^+_{im}I^-_{im}) + I^2_{max}.
\end{equation}
Setting all them to zero results in a system of five equations with five unknowns that has to be solved. As of now, I still have not find a way to solve it.




\newpage
\printbibliography


\end{document}
